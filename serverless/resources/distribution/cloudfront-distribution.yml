Type: AWS::CloudFront::Distribution
Properties:
# Einstellungen für die Distribution - die einzelnen Blöcke spiegeln in etwa den Tags im AWS-Webinterface wieder
# Eine gute Übersicht über die einzelnen Einstellungen findet sich in der AWS-Cloudformation-Doku
  # Id: ${param:distributionId}
  DistributionConfig:
    Enabled: true
    Comment: genAi prototype by serverless-infra
    Origins:
      - OriginAccessControlId:
        DomainName: genai-${self:provider.stage}-prototype.s3.eu-central-1.amazonaws.com
        Id: ${self:service}-${self:provider.stage}
        S3OriginConfig:
          OriginAccessIdentity:

    DefaultCacheBehavior:
      # Die TargetOriginId muss mit der Id des Origins übereinstimmen
      TargetOriginId: ${self:service}-${self:provider.stage}
      ViewerProtocolPolicy: redirect-to-https
      # bzgl. der IDs siehe https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-managed-cache-policies.html
      CachePolicyId: 4135ea2d-6df8-44a3-9df3-4b5a84be39ad # Recommended caching policy
      FunctionAssociations:
        - EventType: viewer-request
          FunctionARN: !GetAtt UseAngularSpa.FunctionARN

  Tags:
    - Key: map-migrated
      Value: mig8HJ3AJM0OD
